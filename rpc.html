<html>
  <head>
    <title>JSchema-RPC</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>  
  <body>
    <center>
      <h1>JSchema-RPC</h1>
    </center>
    <h2>Introduction</h2>
    <p>
      To complement <a href="/">JSchema</a>, JSchema-RPC is a way to specify a RPC end point using JSON.
    </p>
    <h2>RPC URL Convention and File Conventions</h2>
    <p>
      Assuming an end point is at <pre>http://example.com/path/</pre> then the JSchema-RPC should be available at <pre>http://example.com/path/?JSchema-RPC</pre>
    </p>
    <p>
      Locally, JSchema-RPC files should end with the <code>.jsc-rpc</code> file suffix.
    </p>
    <h2>Grammar</h2>
    <p>
      The grammar for a JSchema-RPC file builds on the grammar for JSchema and JSON:
    <pre>
&lt;rpc> ::= 
  '{'
    '"url"' ':' &lt;string> 
    &lt;optional_description>
    &lt;optional_typedefs>
    '"functions"' ':' '[' &lt;function_specs> ']'
  '}'
  
&lt;optional_description>
  '' |
  ',' '"description"' ':' &lt;string> ',' 

&lt;optional_typedefs>
  '' |
  ',' &lt;typedefs_map>

&lt;function_specs> ::= 
  &lt;function_spec> | 
  &lt;function_spec> ',' &lt;function_specs> 

&lt;function_spec> ::= 
  '{' '"name"' ':' &lt;string>
      &lt;optional_description>
      ',' '"args"' ':' '[' &lt;arg_specs> ']'
      &lt;optional_return_type>
  '}'

&lt;arg_specs> ::=
  '' |
  &lt;arg_spec> |
  &lt;arg_spec> ',' &lt;arg_specs>
  
&lt;arg_spec> ::=
  '{' &lt;string> ':' &lt;type> &lt;optional_default> &lt;optional_description> '}'

&lt;optional_default> ::=
  ',' '"default"' ':' &lt;object> |
  ''
&lt;optional_return_type> ::=
    ',' '"returns"' ':' &lt;type> |
    ''
    </pre>
  <h2>Invocation</h2>
  <p>
    Given a JSchema-RPC Document and a function specification, an invocation of the function will be done as follows:
    <ul>
      <li>The "name" of the function will be appended to the "url" (or a different URL if the user has specified one)</li>
      <li>The arguments will be passed along in a manner appropriate for the scheme specified in this composed URL.  In the case of http and its variants, this will be either as a query string or as post variables as a GET or POST, respectively. Values must be provided for every parameter that does not have a default value.  Note: if an end point does not support a given HTTP method, it should say so in its documentation.</li>
      <li>The return content will conform to the type specified as the "return_type" unless an exception is returned, in which case it will conform to the grammar specified in the "Exceptions" section.</li>
    </ul>
  </p>
  <h2>Exceptions</h2>
  <p>
    Exceptions may be raised by a JSchema-RPC end point using a return value of the following form:
    <pre>
&lt;jschema_rpc_exception> ::= 
  '{'
    '"exception@"' ':' &lt;string> &lt;optional_type> &lt;optional_trace>
  '}'

&lt;optional_type> ::=  
  '' | 
  ',' '"exception_type@"' ':' &lt;string>    

&lt;optional_trace> ::=  
  '' | 
  ',' '"trace@"' ':' &lt;string>    
</pre>
    End point creators should strive to provide useful traces, including elements only relevant to the remote procedure, rather than implementation details of the invocation.
  </p>
  <p>
    The optional 'exception_type@' element is only a hint to the client.  Client implementations should make a best effort to produce an equivalent exception on their side, but there are no guarantees regarding the type of exception produced.
  </p>
  <h2>Examples</h2>
  <table class="examples-table">
    <tr>
      <th>
        JSchema-RPC File
      </th>
      <th>
        Example usage (Gosu)
      </th>
    </tr>
    <tr>
      <td>
{ "url" : "http://myserver:8080/employees",
  "description" : "Methods for manipulating employees",
  "typedefs@" : {
    "Employee" : {
      "first_name" : "string",
      "last_name" : "string",
      "age" : "integer",
      "id" : "biginteger"
    }
  }
  "functions" : [
    { "name" : "getEmployee",
      "description" : "Returns the employee of the given name",
      "args" : [ {"id" : "biginteger" } ],
      "return_type" : "Employee"
    },
    { "name" : "updateEmployee",
      "description" : "Updates the given employee",
      "args" : [ { "employee", "Employee" } ],
      "return_type" : "boolean"
    }
  ]
}
      </td>
      <td>
// Assuming the above file is in EmployeeController.jsc-rpc:

var empController = new EmployeeController()

var myEmp = empController.getEmployee(42)

myEmp.age++

if( empController.updateEmployee(myEmp) ) {
  print( "Updated the age of ${myEmp.first_name}")
}
      </td>
    </tr>
  <table>
  </body>
</html>